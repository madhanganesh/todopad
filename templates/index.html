{% extends "base.html" %}

{% block content %}
<div class="flex flex-col p-4 gap-4">
    <div>
        {% include "partials/todo-input.html" %}
    </div>

    <div class="flex items-center justify-between flex-row-reverse">
        {% include "partials/todo-filter.html" %} 
        <span id="todo-count"></span>
    </div>

    <div>
        {% if let Some(todos) = todos %}
            {% include "partials/todos.html" %}
        {%endif%}
    </div>

</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        function updateTodoCount() {
            const count = document.querySelectorAll("#todo-list li").length;
            let text = 'No todos';
            if (count === 1) {
                text = `${count} todo`;
            } 
            if (count > 1) {
                text = `${count} todos`;
            }
            document.getElementById("todo-count").innerText = text
        }

        document.body.addEventListener("htmx:afterRequest", function () {
            updateTodoCount();
        });

        updateTodoCount();
    });

    function parseTags(tooltipId, event) {
        let contentElement = document.getElementById(tooltipId);
        try {
            let tagsArray = JSON.parse(contentElement.innerText); 
            contentElement.innerHTML =  tagsArray.map(tag => `<div>${tag}</div>`).join(``);
            if (event) {
                showTooltip(event, tooltipId);
            }
        } catch (error) {
            contentElement.innerHTML = "<div>Error loading tags</div>"; 
            console.error("Invalid JSON from /tags:", error);
        }
    }

    function showTooltip(event, tooltipId) {
        const content = document.querySelector("#" + tooltipId).innerHTML;
        tippy(event.target, {
            content: content,
            allowHTML: true,
            interactive: true,
            placement: "bottom",
            theme: "light-border",
            duration: 500,  
        }).show();
    }

    function hideTooltip(event) {
        event.target._tippy?.hide();
    }
</script>
{% endblock %}

